import random
import os


def get_dict_key(dictionary, value):
    """
    This returns a the key name from an inputted value
    """

    return list(dictionary.keys())[list(dictionary.values()).index(value)]


def get_int(string):
    """
    Function that handles user input for different
    """
    while True:
        try:
            return int(input(string))

        except ValueError:
            print("Not an integer, try again")


# User has to guess a number generated by the computer
def guessing_function():
    """
    A function that generates a random number and upon
    user input guesses, generates an automatic response.
    Ends when the user correctly guesses the number.

    """

    random_number_100 = random.randint(1, 101)
    user_guess = get_int("Guess an integer between 1 and 100: ")
    while random_number_100 != user_guess:

        try:

            if user_guess > 100 or user_guess < 1:
                print(f"You can't choose {user_guess}\n")
                print("Please pick an integer between 1 and 100 only!")
                user_guess = get_int("Guess an integer between 1 and 100: ")

            elif user_guess > random_number_100:

                print("Too high, try a bit lower!")
                print(user_guess)
                user_guess = get_int("Guess an integer between 1 and 100: ")
            elif user_guess < random_number_100:
                print("Too low, try a bit higher!")
                print(user_guess)
                user_guess = get_int("Guess an integer between 1 and 100: ")

        except ValueError:
            print("Wrong value! Please enter a number between 1 and 100!")
            print(user_guess)

    print(f"You got it! The number was: {random_number_100}")
    end_of_game("guess")


# Computer has to guess a number generated by the User

# User chooses a number
# Computer makes a guess
# User gets an input to say if the number needs to be lower or higher
# by entering 1 for lower, 2 for higher or 3 for when the number is correct
# Continues until computer gets to the correct number
# prompt to play again or something else


def comp_guessing_function():

    """
    A function that generates a random number guess between
    two variables of value 1 and 101, and upon user input,
    adjusts the next guess based on whether the user feedback
    requires a higher or lower number.
    """

    print("Pick a number between 1 and 100, and I'll try to guess it!")
    user_response = get_int("Enter your chosen number here: ")

    mini = 1
    maxi = 101

    user_response = ""
    while user_response != 3:
        try:
            computer_guess = random.randint(mini, maxi)
            print(computer_guess)
            user_response = int(input("Too low? Press [1]. Too high? Press [2]. Correct? press [3]! "))
            if user_response == 1:
                mini = computer_guess + 1
            elif user_response == 2:
                maxi = computer_guess - 1
            elif user_response > 3:
                print("Sorry, enter [1], [2] or [3] only!\n")
                user_response = int(input("Too low? Press [1]. Too high? Press [2]. Correct? press [3]! "))
        except ValueError:
            print("Enter [1] too low, [2] too high or [3] correct, only.\n")
            user_response = int(input("Too low? Press [1]. Too high? Press [2]. Correct? press [3]! "))

    print("Hoorah! I guessed your number")
    end_of_game("guess-ai")


# Coin Toss (Heads/Tails)

# Program begins when user presses a key
# User calls in an input whether they think it will be heads or tails
# The computer makes a guess of its own
# The 'coin' is flipped and a result is generated
# See who wins the round
# Prompt to either 'flip a coin' again or do something else

def get_toss(string):
    """
    Handles user input and returns the value
    """

    while True:
        user_value = get_int(string)
        if user_value == 0 or user_value == 1:
            return user_value
        else:
            print("Invalid input, try again")


def coin_toss():

    """
    Function to replicate a random coin toss,
    where the user can guess in advance what the
    outcome will be.
    """
    coin = {
        "heads": 0,
        "tails": 1
    }

    input("Press enter to begin...")

    coin_faces = list(coin.values())

    user_guess = get_toss("Please enter [0] for heads or [1] for tails!\n")

    flip_coin = random.choice(coin_faces)
    comp_coin_value = get_dict_key(coin, flip_coin)
    user_coin_value = get_dict_key(coin, user_guess)

    while user_guess != 0 or user_guess != 1:

        try:
            if flip_coin == user_guess:
                print(f"You guessed {user_coin_value}({user_guess})")
                print(f"The result was {comp_coin_value}, You got it!")
                break
            elif flip_coin != user_guess:
                print(f"You guessed {user_coin_value}({user_guess})")
                print(f"The result was {comp_coin_value}, try again!")
                break
        except ValueError:
            print("Invalid input. Please enter [0] or [1] only!")
        user_guess = get_toss("Please enter [0] for heads or [1] for tails!\n")
        flip_coin = random.choice(coin_faces)
        comp_coin_value = get_dict_key(coin, flip_coin)
        user_coin_value = get_dict_key(coin, user_guess)
    end_of_game("coin-toss")


def end_of_game(game):

    """
    Function to give user a choice whether to repeat the program
    or to return to the start menu.
    """

    print("If you'd like to play again, press [x].")
    print("If not, to go back to the menu, press [c]")
    decision = input("")

    while decision != "x" or decision != "c":
        clear_terminal()
        if decision == "x":
            if game == "guess":
                guessing_function()
            elif game == "guess-ai":
                comp_guessing_function()
            elif game == "coin-toss":
                coin_toss()
        elif decision == "c":
            start_menu()
        else:
            print("Wrong input.\n")
        decision = input("Enter [x] - play again or [c] - go back: ")


def clear_terminal():
    """
    This function will clear the terminal at the end of a program
    round in order to prevent the terminal from becoming too long
    and cluttered. "posix" is the term referring to Linux or
    MacOS operating systems. "nt, dos and ce" are for DOS or Windows operating
    systems.
    """
    if os.name == "posix":
        os.system("clear")
    elif os.name in ("nt", "dos", "ce"):
        os.system("CLS")
    else:
        print("\n" * 150)


def start_menu():
    """
    Runs the menu introduction and provides player with an input to
    pick one of three options.
    """

    print("Welcome to my Guess-The-Number python application!")
    print("A game where you or the computer can try to guess a number.")
    print("A 'coin toss' program is included too, if you prefer those odds!\n")
    print("Please enter:\n")
    print("1 for Guess-The-Number")
    print("2 for Guess-The-Number (AI)")
    print("3 for the 'coin-toss' program\n")

    menu_input = get_int("Please pick a number from the options provided: ")

    while menu_input != 0:

        if menu_input == 1:
            guessing_function()

        elif menu_input == 2:
            comp_guessing_function()

        elif menu_input == 3:
            coin_toss()
        else:
            print("Please enter 0, 1, 2 or 3 only")
            print("0 to exit the application")
            print("1 for Guess-The-Number")
            print("2 for Guess-The-Number (AI)")
            print("3 for the 'coin-toss' program\n")
        menu_input = get_int("Please pick a number from the options provided:")
    print("Bye!")


start_menu()
